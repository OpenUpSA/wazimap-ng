/*!
 * Dropmic.js v0.3.3
 * (c) 2016-2020 Agence Webup
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Dropmic=e()}(this,function(){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(){function o(t,e){var n,i,s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.target=t,this.btn=t.querySelector("[data-dropmic-btn]"),this.container=null,this.showClass="dropmic--show",this.defaults=((i="beforeClose")in(n={onOpen:s=null,onClose:null,beforeClose:null})?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n),this.options=this.extendObject({},this.defaults,e),this.list=null,this.custom=null,this.initialized=!1,this.init()}var t,e,n;return t=o,(e=[{key:"init",value:function(){this._bindEvents()}},{key:"_findAncestor",value:function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}},{key:"_stringToDom",value:function(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}},{key:"_bindEvents",value:function(){var s=this;this.btn.addEventListener("click",function(t){t.preventDefault(),s.target.classList.contains(s.showClass)?s.close():s.open()}),document.addEventListener("click",function(t){s._findAncestor(t.target,"dropmic")!==s.target&&s.target.classList.contains(s.showClass)&&s.close.call(s)}),this.target.addEventListener("keydown",function(t){27===t.keyCode&&(s.close(),s.btn.focus())}),this.target.addEventListener("keydown",function(t){var e,n,i;s.target.classList.contains(s.showClass)&&(n=(e=s.target.querySelectorAll(".dropmic-menu__listContent")).length-1,9===t.keyCode&&document.activeElement===e[n]&&(t.preventDefault(),e[0].focus()),38!==t.keyCode&&40!==t.keyCode||(t.preventDefault(),void 0===(i=s._getCurrentItemIndex(e,document.activeElement))?e[0].focus():38===t.keyCode?e[self._getPreviousItemIndex(e,i)].focus():e[self._getNextItemIndex(e,i)].focus()))})}},{key:"_getCurrentItemIndex",value:function(t,e){for(var n=0;n<t.length;n++)if(e===t[n])return n}},{key:"_getPreviousItemIndex",value:function(t,e){return 0<e?e-1:t.length-1}},{key:"_getNextItemIndex",value:function(t,e){return e===t.length-1?0:e+1}},{key:"_isInitialized",value:function(){!1===this.initialized&&(this._constructDropdown(),this.initialized=!0)}},{key:"_constructDropdown",value:function(){this.container=this._stringToDom('<div class="dropmic-menu" aria-hidden="true"></div>'),this.target.appendChild(this.container)}},{key:"_constructList",value:function(){return null===this.list&&(this.list=this._stringToDom('<ul class="dropmic-menu__list" role="menu"></ul>'),this.container.appendChild(this.list)),this.list}},{key:"_constructItem",value:function(t){var e=this._stringToDom('<li class="dropmic-menu__listItem" role="menuitem"></li>');return e.appendChild(t),e}},{key:"_constructCustom",value:function(t){null===this.custom?(this.custom=this._stringToDom('<div class="dropmic-menu__custom">'.concat(t,"</div>")),this.container.appendChild(this.custom)):this.custom.innerHTML=t}},{key:"_onOpen",value:function(){this.options.onOpen&&this.options.onOpen()}},{key:"_onClose",value:function(){this.options.onClose&&this.options.onClose()}},{key:"_beforeOpen",value:function(){this.options.beforeOpen&&this.options.beforeOpen()}},{key:"_beforeClose",value:function(){this.options.beforeClose&&this.options.beforeClose()}},{key:"extendObject",value:function(t){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n]);return t}},{key:"addLink",value:function(t,e){this._isInitialized();var n=this._stringToDom('<a class="dropmic-menu__listContent" href="'.concat(e,'" tabindex="-1">').concat(t,"</a>"));this._constructList().appendChild(this._constructItem(n))}},{key:"addBtn",value:function(t,e){if(this._isInitialized(),"function"==typeof e){var n=this._stringToDom('<button class="dropmic-menu__listContent" tabindex="-1"></button>');return n.innerHTML=t,this._constructList().appendChild(this._constructItem(n)),n.addEventListener("click",function(t){e(t)}),n}}},{key:"addLabel",value:function(t){this._isInitialized();var e=this._stringToDom('<span class="dropmic-menu__listContent">'.concat(t,"</span>"));this._constructList().appendChild(this._constructItem(e))}},{key:"setCustomContent",value:function(t){this._isInitialized(),this._constructCustom(t)}},{key:"updateTargetBtn",value:function(t){this.btn.innerHTML=t}},{key:"open",value:function(){this._beforeOpen(),this.target.classList.add(this.showClass),this.target.querySelector("[aria-hidden]").setAttribute("aria-hidden","false");var t=this.target.querySelectorAll(".dropmic-menu__listContent");[].forEach.call(t,function(t){t.setAttribute("tabindex","0")}),this._onOpen()}},{key:"close",value:function(){this._beforeClose(),this.target.classList.remove(this.showClass),this.target.querySelector("[aria-hidden]").setAttribute("aria-hidden","true");var t=this.target.querySelectorAll(".dropmic-menu__listContent");[].forEach.call(t,function(t){t.setAttribute("tabindex","-1")}),this._onClose()}}])&&i(t.prototype,e),n&&i(t,n),o}()});
