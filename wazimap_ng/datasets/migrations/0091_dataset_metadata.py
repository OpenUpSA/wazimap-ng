# Generated by Django 2.2.10 on 2020-04-29 09:04

from django.db import migrations, models
import django.db.models.deletion


def copy_metadata_to_general_metadata(apps, schema_editor):
    """
    copy metadata from dataset.MetaData to general.MetaData
    """
    dataset_MD = apps.get_model('datasets', 'MetaData')
    general_MD = apps.get_model('general', 'MetaData')
    Dataset = apps.get_model('datasets', 'Dataset')

    for metadata in dataset_MD.objects.all():
        dataset = Dataset.objects.filter(id=metadata.id).first()
        if dataset:
            new_metadata = general_MD.objects.create(
                source=metadata.source,
                description=metadata.description,
                licence=metadata.licence
            )

            dataset.metadata = new_metadata
            dataset.save()

class Migration(migrations.Migration):

    dependencies = [
        ('general', '0001_initial'),
        ('datasets', '0090_auto_20200429_0902'),
    ]

    operations = [
        migrations.AddField(
            model_name='dataset',
            name='metadata',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='general.MetaData'),
        ),
        migrations.RunPython(copy_metadata_to_general_metadata),
    ]
